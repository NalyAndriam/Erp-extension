<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERPNext - Purchase Invoices</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/navbar.css}">
    <link rel="stylesheet" th:href="@{/css/sidebar.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        .title-link {
            text-decoration: none;
            color: inherit;
        }
        .title-link:hover {
            text-decoration: underline;
            color: inherit;
        }



        .alert {
            border-radius: 6px;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
        }
        .alert-danger {
            background-color: #ffeaea;
            color: #e53935;
        }
        .actions-col {
            text-align: right;
        }
        .no-result {
            font-size: 0.875rem;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <div th:replace="~{navbar :: navbar}"></div>

    <!-- Sidebar -->
    <div th:replace="~{sidebar :: sidebar}"></div>

    <!-- Main content -->
    <div class="main-content">
        <div class="container-fluid mt-4">
            <div class="page-head">
                <h1 class="page-title">Purchase Invoices</h1>
            </div>

            <!-- Error message -->
            <div th:if="${error}" class="alert alert-danger" role="alert">
                <i class="fa-solid fa-circle-exclamation me-2"></i>
                <span th:text="${error}"></span>
            </div>

            <!-- List view with table -->
            <div class="frappe-list">
                <table class="frappe-table">
                    <thead>
                        <tr class="list-row-head">
                            <th>Name</th>
                            <th>Supplier</th>
                            <th>Status</th>
                            <th>Grand Total</th>
                            <th>Outstanding Amount</th>
                            <th>Posting Date</th>
                            <th>Due Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody class="list-row-container">
                        <tr class="list-row" th:each="invoice : ${invoices}">
                            <td>
                                <a th:href="@{/invoice-details/{id}(id=${invoice.name})}"
                                   th:text="${invoice.name}"
                                   class="title-link"></a>
                            </td>
                            <td th:text="${invoice.supplier}"></td>
                            <td>
                                <span th:text="${invoice.status}"
                                      th:class="${invoice.status == 'Unpaid' ? 'indicator-pill orange' : 
                                                  invoice.status == 'Submitted' ? 'indicator-pill blue' : 
                                                  invoice.status == 'Paid' ? 'indicator-pill green' : 
                                                  invoice.status == 'Overdue' ? 'indicator-pill red' : 
                                                  invoice.status == 'Partially Paid' ? 'indicator-pill yellow' : 'indicator-pill gray'}">
                                </span>
                            </td>
                            <td th:text="${#numbers.formatDecimal(invoice.grandTotal, 0, 'COMMA', 2, 'POINT')}"></td>
                            <td th:text="${#numbers.formatDecimal(invoice.outstandingAmount, 0, 'COMMA', 2, 'POINT')}"></td>
                            <td th:text="${invoice.postingDate}"></td>
                            <td th:text="${invoice.dueDate}"></td>
                            <td class="actions-col">
                                <div class="actions">
                                    <th:block th:if="${invoice.status == 'Unpaid' or invoice.status == 'Partially Paid' or invoice.status == 'Overdue'}">
                                        <a th:href="@{/payment-form/{id}(id=${invoice.name})}"
                                           class="btn btn-sm btn-link">
                                            Create Payment
                                        </a>
                                    </th:block>
                                    <th:block th:unless="${invoice.status == 'Unpaid' or invoice.status == 'Partially Paid' or invoice.status == 'Overdue'}">
                                        <span class="btn btn-sm btn-link disabled">Payment unavailable</span>
                                    </th:block>
                                </div>
                            </td>
                        </tr>
                        <tr th:if="${invoices == null or invoices.isEmpty()}">
                            <td colspan="8" class="no-result text-muted text-center py-4">
                                No purchase invoices found.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/js/bootstrap.bundle.min.js"></script>
    <script>
        // Toggle sidebar on mobile
        document.querySelector('.navbar-toggler').addEventListener('click', function() {
            document.querySelector('.sidebar').classList.toggle('show');
        });
    </script>
</body>
</html>