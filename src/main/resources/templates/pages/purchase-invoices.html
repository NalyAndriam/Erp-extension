<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERPNext - Purchase Invoices</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/navbar.css}">
    <link rel="stylesheet" th:href="@{/css/sidebar.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        .title-link {
            text-decoration: none; /* Supprime le soulignement par défaut */
            color: inherit; /* Conserve la couleur du texte par défaut (pas de couleur bleue) */
        }
        .title-link:hover {
            text-decoration: underline; /* Ajoute un soulignement au survol */
            color: inherit; /* Conserve la couleur du texte par défaut au survol */
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <div th:replace="~{navbar :: navbar}"></div>

    <!-- Sidebar -->
    <div th:replace="~{sidebar :: sidebar}"></div>

    <!-- Main content -->
    <div class="main-content">
        <div class="container-fluid mt-4">
            <div class="page-head">
                <h1 class="page-title">Purchase Invoices</h1>
            </div>

            <!-- Error message -->
            <div th:if="${error}" class="alert alert-danger" role="alert">
                <span th:text="${error}"></span>
            </div>

            <!-- List view with table -->
            <div class="frappe-list">
                <!-- Dans purchase-invoices.html, remplacez la table existante par celle-ci -->
                <table class="frappe-table">
                    <thead>
                        <tr class="list-row-head">
                            <th>Title</th>
                            <th>Supplier</th>
                            <th>Status</th>
                            <th>Posting Date</th>
                            <th>Grand Total</th>
                            <th>ID</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody class="list-row-container">
                        <tr class="list-row" th:each="invoice : ${invoices}">
                            <td>
                                <a th:href="@{'/invoice-details/' + ${invoice.name}}"
                                th:text="${invoice.title}"
                                class="title-link"></a>
                            </td>
                            <td th:text="${invoice.supplier}"></td>
                            <td>
                                <span th:text="${invoice.status}"
                                    th:class="${invoice.status == 'Unpaid' ? 'indicator-pill orange' : 
                                                invoice.status == 'Submitted' ? 'indicator-pill blue' : 
                                                invoice.status == 'Paid' ? 'indicator-pill green' : 
                                                invoice.status == 'Overdue' ? 'indicator-pill red' : 
                                                invoice.status == 'Unpaid' ? 'indicator-pill yellow' : 'indicator-pill gray'}">
                                </span>
                            </td>
                            <td th:text="${invoice.posting_date}"></td>
                            <td th:text="${#numbers.formatDecimal(invoice.grand_total, 0, 'COMMA', 2, 'POINT')}"></td>
                            <td th:text="${invoice.name}"></td>
                            <td class="actions-col">
                                <div class="actions">
                                    <th:block th:if="${invoice.status != 'Paid' && invoice.status != 'Cancelled'}">
                                        <a th:href="@{/create-payment/{id}(id=${invoice.name})}" 
                                        class="btn btn-sm btn-link"
                                        onclick="createPayment('${invoice.name}')">
                                            Create Payment
                                        </a>
                                    </th:block>
                                    <th:block th:unless="${invoice.status != 'Paid' && invoice.status != 'Cancelled'}">
                                        <span class="btn btn-sm btn-link disabled">Payment unavailable</span>
                                    </th:block>
                                </div>
                            </td>
                        </tr>
                        <tr th:if="${invoices == null or invoices.isEmpty()}">
                            <td colspan="7" class="no-result text-muted text-center py-4">
                                No purchase invoices found.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>   
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/js/bootstrap.bundle.min.js"></script>
    <script>
        // Toggle sidebar on mobile
        document.querySelector('.navbar-toggler').addEventListener('click', function() {
            document.querySelector('.sidebar').classList.toggle('show');
        });
    </script>
</body>
</html>